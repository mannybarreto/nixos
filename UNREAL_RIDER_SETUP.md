# JetBrains Rider + Unreal Engine 5.6.1 Setup Guide

This guide explains how to set up and use JetBrains Rider for Unreal Engine development on NixOS with distrobox containerization.

## Overview

Your NixOS configuration provides:

- **JetBrains Rider IDE** - Full-featured C++ and .NET development environment
- **Unreal Engine Integration** - Seamless integration with Unreal Engine 5.6.1
- **Containerized Development** - Distrobox container for Unreal Engine runtime
- **Development Tools** - Complete C++/.NET toolchain
- **Helper Scripts** - Automated build, debug, and project generation tools

## System Architecture

### Container Setup
- **Container Name**: `unreal` (Ubuntu 22.04 based)
- **Engine Path**: `~/distrobox/unreal/Linux_Unreal_Engine_5.6.1/`
- **Projects Directory**: `~/distrobox/unreal/Projects/`
- **Container Runtime**: Podman with NVIDIA GPU support

### Host System Tools
- JetBrains Rider (installed via Nix)
- C++ toolchain (Clang, GDB, LLDB)
- .NET SDK 8.0
- Build tools (CMake, Ninja, Make)

## Installation

### 1. Apply NixOS Configuration

```bash
# Rebuild your system with the new configuration
sudo nixos-rebuild switch

# Verify installations
which rider
which unreal
which unreal-rider
```

### 2. Configure JetBrains Rider

Run the configuration helper to set up Rider for Unreal Engine:

```bash
# Configure Rider settings for Unreal Engine
rider-configure-unreal
```

This will:
- Set the Unreal Engine root path
- Configure project file generation paths
- Set up C++ code style for Unreal Engine standards
- Configure UnrealBuildTool integration

## Available Commands

### Core Launchers

#### `unreal` - Launch Unreal Editor
```bash
# Launch Unreal Editor
unreal

# Open specific project
unreal ~/distrobox/unreal/Projects/MyGame/MyGame.uproject
```

#### `unreal-rider` - Launch Rider for Unreal Projects
```bash
# Launch Rider
unreal-rider

# Open a project (generates project files if needed)
unreal-rider MyGame.uproject

# Open existing solution
unreal-rider MyGame.sln

# Generate project files only
unreal-rider --generate-only MyGame.uproject
```

### Build Tools

#### `unreal-build` - Build Helper
```bash
# Build project (default: Development configuration for Linux)
unreal-build build MyGame.uproject

# Build with specific configuration
unreal-build build MyGame.uproject Debug Linux

# Generate project files
unreal-build generate MyGame.uproject

# Clean project (removes Binaries, Intermediate, .vs, *.sln)
unreal-build clean MyGame.uproject
```

### Debugging

#### `unreal-debug` - Debug Helper
```bash
# Launch project with GDB debugger
unreal-debug launch MyGame.uproject

# Attach debugger to running UnrealEditor
unreal-debug attach
```

### Project File Generation

#### `GenerateProjectFiles.sh` - Wrapper Script
This wrapper allows Rider to call GenerateProjectFiles.sh through distrobox:
```bash
GenerateProjectFiles.sh -project="/path/to/MyGame.uproject" -game -rider
```

## Development Workflow

### 1. Create a New Project

```bash
# Launch Unreal Editor
unreal

# In the Editor:
# 1. Create New Project
# 2. Choose C++ template (e.g., Third Person)
# 3. Set location to ~/distrobox/unreal/Projects/MyGame
# 4. Create project
```

### 2. Open in Rider

```bash
# Generate project files and open in Rider
unreal-rider ~/distrobox/unreal/Projects/MyGame/MyGame.uproject
```

### 3. Build and Test

```bash
# Build the project
unreal-build build ~/distrobox/unreal/Projects/MyGame/MyGame.uproject

# Launch with debugger
unreal-debug launch ~/distrobox/unreal/Projects/MyGame/MyGame.uproject
```

## Project Structure

```
~/distrobox/unreal/
├── Linux_Unreal_Engine_5.6.1/    # Unreal Engine installation
│   ├── Engine/
│   ├── FeaturePacks/
│   ├── Samples/
│   └── Templates/
├── Projects/                      # Your projects
│   └── MyGame/
│       ├── Config/
│       ├── Content/
│       ├── Source/
│       ├── MyGame.uproject
│       └── MyGame.sln            # Generated by unreal-rider
└── Library/                       # Unreal Engine library cache
```

## Environment Variables

The configuration sets these environment variables:

- `UE_ENGINE_LOCATION` - Path to Unreal Engine
- `UE_PROJECTS_DIR` - Default projects directory
- `UE_INSTALL_LOCATION` - Engine installation path
- `UNREAL_ENGINE_PATH` - Alternative engine path variable
- `SDL_VIDEODRIVER` - Set to Wayland for graphics
- `VK_ICD_FILENAMES` - Vulkan driver configuration

## Troubleshooting

### Container Not Found
```bash
# Check if container exists
distrobox list

# Create container if missing
distrobox create --name unreal --image ubuntu:22.04 --nvidia
```

### Rider Configuration Issues
```bash
# Re-run configuration
rider-configure-unreal

# Check Rider config directory
ls ~/.config/JetBrains/Rider*/options/
```

### Build Failures
```bash
# Enter container to debug
distrobox enter unreal

# Check tool availability
which clang++
dotnet --version
```

### Graphics/GPU Issues
```bash
# Verify NVIDIA support in container
distrobox enter unreal
nvidia-smi
```

### Project Generation Failed
```bash
# Try manual generation
distrobox enter unreal
cd ~/distrobox/unreal/Linux_Unreal_Engine_5.6.1
./GenerateProjectFiles.sh ~/distrobox/unreal/Projects/MyGame/MyGame.uproject
```

## Tips and Best Practices

### Performance
- Keep projects on SSD storage for faster builds
- Use `unreal-build clean` periodically to free disk space
- Consider using ccache in the container for faster rebuilds

### Version Control
- Add to `.gitignore`:
  ```
  Binaries/
  DerivedDataCache/
  Intermediate/
  Saved/
  .vs/
  *.VC.db
  *.opensdf
  *.opendb
  *.sdf
  *.sln
  *.suo
  *.xcodeproj
  *.xcworkspace
  ```

### Container Management
- The container persists between sessions
- Updates inside container: `distrobox enter unreal -- sudo apt update && sudo apt upgrade`
- Reset container: `distrobox rm unreal && distrobox create --name unreal --image ubuntu:22.04 --nvidia`

### Rider Settings
- Enable "External Changes" auto-reload for smoother workflow
- Configure external tools to use the `unreal-build` commands
- Set up run configurations using the `unreal` launcher

## File Locations

### Configuration Files
- Nix modules: `~/nixos-config/modules/nixos/unreal.nix`, `~/nixos-config/modules/home-manager/jetbrains.nix`
- Rider config: `~/.config/JetBrains/Rider*/`

### Installed Scripts
- `/etc/profiles/per-user/$USER/bin/unreal`
- `/etc/profiles/per-user/$USER/bin/unreal-rider`
- `/etc/profiles/per-user/$USER/bin/unreal-build`
- `/etc/profiles/per-user/$USER/bin/unreal-debug`
- `/etc/profiles/per-user/$USER/bin/rider-configure-unreal`
- `/etc/profiles/per-user/$USER/bin/GenerateProjectFiles.sh`

## Next Steps

1. **Run `rider-configure-unreal`** to set up Rider
2. **Create your first project** using Unreal Editor
3. **Open in Rider** using `unreal-rider MyGame.uproject`
4. **Build and debug** using the helper scripts

---

*Configuration: NixOS with distrobox/podman*  
*Compatible with: Unreal Engine 5.6.1, JetBrains Rider*